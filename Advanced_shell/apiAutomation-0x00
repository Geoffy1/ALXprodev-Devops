#!/bin/bash

# Define the API endpoint and the PokÃ©mon name
API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"
DATA_FILE="data.json"
ERROR_FILE="errors.txt"

# Make the API request and capture the HTTP status code
# The -sS flag makes curl silent but shows errors
# The -w "%{http_code}" flag prints the HTTP status code at the end
response=$(curl -sS -w "%{http_code}" "$API_URL" -o "$DATA_FILE")
http_status=${response: -3}

# Check if the HTTP status code indicates success (e.g., 200 OK)
if [ "$http_status" -eq 200 ]; then
  echo "Successfully fetched data for Pikachu and saved to $DATA_FILE."
else
  # The request failed. Log the error and the HTTP status code.
  echo "$(date): ERROR: Failed to fetch data from $API_URL. HTTP Status: $http_status" >> "$ERROR_FILE"
  echo "Failed to fetch data. Error logged to $ERROR_FILE."
  # Remove the potentially empty or incomplete data file
  rm -f "$DATA_FILE"
fi